{% comment %} /snippets/bundle-debug.liquid - CORRECT APPROACH: Fetch full products {% endcomment %}

<script>
// CORRECT APPROACH: FETCH FULL COMPONENT PRODUCTS

const isBundle = {% if product.metafields.bundleinfo.bundleproducts.value %}true{% else %}false{% endif %};

if (isBundle) {
  const bundleComponents = {{ product.metafields.bundleinfo.bundleproducts.value | json }};
  const bundleOptions = {{ product.options | json }};
  const currentVariant = {{ product.selected_or_first_available_variant | json }};
  
  console.log("=== CORRECT APPROACH: FULL PRODUCT DATA ===");
  
  // Step 1: Get full product data for each component
  const fullComponentProducts = [];
  
  {% for component in product.metafields.bundleinfo.bundleproducts.value %}
    {% assign full_product = all_products[component.handle] %}
    fullComponentProducts.push({{ full_product | json }});
  {% endfor %}
  
  console.log("Bundle components count:", bundleComponents.length);
  console.log("Full products count:", fullComponentProducts.length);
  
  // Debug each full component product
  fullComponentProducts.forEach((fullProduct, index) => {
    console.log(`\n--- FULL Component ${index + 1}: ${fullProduct.title} ---`);
    console.log("Handle:", fullProduct.handle);
    console.log("Full product metafields:", fullProduct.metafields || "UNDEFINED");
    
    if (fullProduct.variants && fullProduct.variants.length > 0) {
      console.log(`Variants count: ${fullProduct.variants.length}`);
      
      // Show delivery metafields for each variant
      fullProduct.variants.forEach((variant, vIndex) => {
        console.log(`\nVariant ${vIndex + 1}: "${variant.title}"`);
        if (variant.metafields && variant.metafields.delivery) {
          console.log("  ✅ HAS DELIVERY METAFIELDS:", variant.metafields.delivery);
        } else {
          console.log("  ❌ No delivery metafields");
        }
      });
    }
    
    // Show product-level delivery metafields
    if (fullProduct.metafields && fullProduct.metafields.delivery) {
      console.log("Product-level delivery metafields:", fullProduct.metafields.delivery);
    } else {
      console.log("No product-level delivery metafields");
    }
  });
  
  console.log("\n--- BUNDLE METAFIELDS ---");
  console.log("Bundle product metafields:", {{ product.metafields | json }});
  console.log("Bundle variant metafields:", currentVariant.metafields || "UNDEFINED");
  
} else {
  console.log("Not a bundle product");
}
</script> 