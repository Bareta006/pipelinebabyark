{% comment %}
  /snippets/video-json-ld.liquid
  
  Generates JSON-LD VideoObject structured data for video slides
  
  Parameters:
  - video_slides: Array of video blocks/slides
  - section_id: Unique section identifier 
  - page_path: Current page path (optional, defaults to request.path)
  
  Usage:
  {% render 'video-json-ld', 
    video_slides: section.blocks,
    section_id: section.id
  %}
{% endcomment %}

{% comment %} Simple filter for video blocks {% endcomment %}
{% assign video_count = 0 %}
{% for block in video_slides %}
  {% if block.settings.video_file or block.settings.video_url or block.settings.video_bg or block.settings.mobile_video_bg %}
    {% assign video_count = video_count | plus: 1 %}
  {% endif %}
{% endfor %}

{% if video_count > 0 %}
  {%- assign page_url = page_path | default: request.path -%}
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    {% if video_count == 1 %}
      "@type": "VideoObject",
      {% for block in video_slides %}
        {% if block.settings.video_file or block.settings.video_url or block.settings.video_bg or block.settings.mobile_video_bg %}
          "name": "{{ block.settings.title | default: 'Video Content' | strip_html | escape }}",
          "description": "{{ block.settings.richtext | default: block.settings.description | strip_html | truncate: 160 | default: block.settings.title | default: 'Video content' | escape }}",
          {% if block.settings.video_file %}
            "contentUrl": "{{ block.settings.video_file.sources[0].url }}",
            "duration": "PT{{ block.settings.video_file.duration | default: 30 }}S",
          {% elsif block.settings.video_url %}
            "contentUrl": "{{ block.settings.video_url }}",
            "duration": "PT30S",
          {% elsif block.settings.video_bg %}
            "contentUrl": "{{ block.settings.video_bg.sources[0].url }}",
            "duration": "PT{{ block.settings.video_bg.duration | default: 30 }}S",
          {% elsif block.settings.mobile_video_bg %}
            "contentUrl": "{{ block.settings.mobile_video_bg.sources[0].url }}",
            "duration": "PT{{ block.settings.mobile_video_bg.duration | default: 30 }}S",
          {% endif %}
          {% if block.settings.image %}
            "thumbnailUrl": "{{ block.settings.image | image_url: width: 1200 }}",
          {% endif %}
          "uploadDate": "{{ 'now' | date: '%Y-%m-%dT%H:%M:%S%z' }}",
          "embedUrl": "{{ request.origin }}{{ page_url }}#{{ section_id }}"
          {% break %}
        {% endif %}
      {% endfor %}
    {% else %}
      "@type": "ItemList",
      "itemListElement": [
        {% assign item_index = 0 %}
        {% for block in video_slides %}
          {% if block.settings.video_file or block.settings.video_url or block.settings.video_bg or block.settings.mobile_video_bg %}
            {% assign item_index = item_index | plus: 1 %}
            {
              "@type": "VideoObject",
              "name": "{{ block.settings.title | default: 'Video Content' | strip_html | escape }}",
              "description": "{{ block.settings.richtext | default: block.settings.description | strip_html | truncate: 160 | default: block.settings.title | default: 'Video content' | escape }}",
              {% if block.settings.video_file %}
                "contentUrl": "{{ block.settings.video_file.sources[0].url }}",
                "duration": "PT{{ block.settings.video_file.duration | default: 30 }}S",
              {% elsif block.settings.video_url %}
                "contentUrl": "{{ block.settings.video_url }}",
                "duration": "PT30S",
              {% elsif block.settings.video_bg %}
                "contentUrl": "{{ block.settings.video_bg.sources[0].url }}",
                "duration": "PT{{ block.settings.video_bg.duration | default: 30 }}S",
              {% elsif block.settings.mobile_video_bg %}
                "contentUrl": "{{ block.settings.mobile_video_bg.sources[0].url }}",
                "duration": "PT{{ block.settings.mobile_video_bg.duration | default: 30 }}S",
              {% endif %}
              {% if block.settings.image %}
                "thumbnailUrl": "{{ block.settings.image | image_url: width: 1200 }}",
              {% endif %}
              "uploadDate": "{{ 'now' | date: '%Y-%m-%dT%H:%M:%S%z' }}",
              "embedUrl": "{{ request.origin }}{{ page_url }}#{{ section_id }}-{{ item_index }}"
            }{% unless item_index == video_count %},{% endunless %}
          {% endif %}
        {% endfor %}
      ]
    {% endif %}
  }
  </script>
{% endif %} 