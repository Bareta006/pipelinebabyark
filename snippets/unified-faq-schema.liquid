{% comment %}
  /snippets/unified-faq-schema.liquid
  
  Unified FAQ Schema - Collects all FAQ sections on page
  Generates single FAQPage schema to comply with Google guidelines
  Place in theme.liquid before </body>
{% endcomment %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Find all FAQ sections on the page
  const faqSections = document.querySelectorAll('[data-faq-section="true"]');
  
  console.log('FAQ Sections found:', faqSections.length);
  
  if (faqSections.length === 0) return; // No FAQ sections found
  
  // Collect all FAQ questions from all sections
  let allQuestions = [];
  
  faqSections.forEach((section, index) => {
    console.log(`Processing section ${index + 1}:`, section);
    
    const questionsData = section.getAttribute('data-faq-questions');
    console.log(`Section ${index + 1} data:`, questionsData);
    
    if (questionsData) {
      try {
        const questions = JSON.parse(questionsData);
        console.log(`Section ${index + 1} parsed questions:`, questions);
        allQuestions = allQuestions.concat(questions);
      } catch (e) {
        console.warn(`Failed to parse FAQ questions for section ${index + 1}:`, e);
        console.warn('Raw data was:', questionsData);
      }
    }
  });
  
  console.log('Total questions collected:', allQuestions.length);
  console.log('All questions:', allQuestions);
  
  // Only generate schema if we have questions
  if (allQuestions.length === 0) return;
  
  // Create unified FAQ schema
  const faqSchema = {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": allQuestions.map(item => ({
      "@type": "Question",
      "name": item.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": item.answer
      }
    }))
  };
  
  console.log('Generated FAQ schema:', faqSchema);
  
  // Create and append schema script tag
  const schemaScript = document.createElement('script');
  schemaScript.type = 'application/ld+json';
  schemaScript.textContent = JSON.stringify(faqSchema);
  document.head.appendChild(schemaScript);
  
  console.log('FAQ schema added to page');
});
</script> 