<!-- /snippets/search-bar.liquid -->

<main-search>
  <form action="{{ routes.search_url }}" method="get" class="search-bar search-bar--styled" role="search">
    {% comment %}
      Preserve blog-specific search parameters from URL
      These come from blog search forms that scope results to a specific blog
    {% endcomment %}
    {% assign url_params = request.url | split: '?' %}
    {% if url_params.size > 1 %}
      {% assign query_string = url_params[1] %}
      {% assign params = query_string | split: '&' %}
      
      {% for param in params %}
        {% assign param_parts = param | split: '=' %}
        {% if param_parts.size == 2 %}
          {% assign param_name = param_parts[0] | url_decode %}
          {% assign param_value = param_parts[1] | url_decode %}
          
          {% comment %}Preserve blog-specific search parameters{% endcomment %}
          {% if param_name == 'type' and param_value == 'article' %}
            <input type="hidden" name="type" value="article">
          {% elsif param_name == 'options[prefix]' and param_value == 'last' %}
            <input type="hidden" name="options[prefix]" value="last">
          {% elsif param_name contains 'options[blog]' %}
            <input type="hidden" name="options[blog]" value="{{ param_value }}">
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}
    
    <input class="search-bar__input"
           type="search"
           name="q"
           value="{{ search.terms | escape }}"
           placeholder="{{ 'general.search.placeholder' | t }}"
           aria-label="{{ 'general.search.placeholder' | t }}"
           autocomplete="off">
    
    {% if search.terms != blank %}
      <button type="reset" class="search-bar__reset" aria-label="{{ 'general.search.reset' | t }}">
        {% render 'icon-core-x' %}
      </button>
    {% endif %}
    
    <button type="submit" class="search-bar__button">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15 15L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10C17 13.866 13.866 17 10 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </form>
</main-search>
